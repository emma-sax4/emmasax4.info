<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="msapplication-TileColor" content="#2d89ef">
    <meta name="msapplication-TileImage" content="/assets/images/favicon/mstile-150x150.png">
    <meta name="msapplication-config" content="/assets/images/favicon/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/images/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/assets/images/favicon/android-chrome-96x96.png">
    <link rel="icon" type="image/png" sizes="48x48" href="/assets/images/favicon/favicon-48x48.png">
    <link rel="icon" type="image/png" sizes="196x196" href="/assets/images/favicon/favicon-196x196.png">
    <link rel="manifest" href="/assets/images/favicon/site.webmanifest">
    <link rel="mask-icon" href="/assets/images/favicon/safari-pinned-tab.svg" color="#1144ef">
    <link rel="stylesheet" href="/assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="alternate" href="https://emmasax4.info/feed.xml" type="application/rss+xml">
    <!-- Begin Jekyll SEO tag v2.6.1 -->
    <title>Emma Sax | Time Zones, UTC, and Javascript‚Ä¶ Oh My!</title>
    <meta name="generator" content="Jekyll v3.8.7" />
    <meta property="og:title" content="Emma Sax | Time Zones, UTC, and Javascript‚Ä¶ Oh My!" />
    <meta name="author" content="Emma Sax" />
    <meta property="og:locale" content="en_US" />
    <meta name="description" content="Emma Sax‚Äôs personal website and blog. Includes information about my social media profiles, r√©sum√©, and hobbies." />
    <meta property="og:description" content="Emma Sax‚Äôs personal website and blog. Includes information about my social media profiles, r√©sum√©, and hobbies." />
    <link rel="canonical" href="https://emmasax4.info/blog/posts/time-zones-utc-and-javascript-oh-my/" />
    <meta property="og:url" content="https://emmasax4.info/blog/posts/time-zones-utc-and-javascript-oh-my/" />
    <meta property="og:site_name" content="Emma Sax" />
    <meta property="og:type" content="article" />
    <meta property="article:published_time" content="2020-02-07T06:00:00+00:00" />
    <meta name="twitter:card" content="summary" />
    <meta property="twitter:title" content="Time Zones, UTC, and Javascript‚Ä¶ Oh My!" />
    <meta name="google-site-verification" content="v04az8eo-0UcZrWCJr7SKAvM6hw90qTCBQoKx3PlXCA" />
    <meta name="msvalidate.01" content="89B2B19FF966341B78EF64EDADE6DF81" />
    <meta name="yandex-verification" content="c2741887f8c30dd1" />
    <script type="application/ld+json">
      {"description":"Emma Sax‚Äôs personal website and blog. Includes information about my social media profiles, r√©sum√©, and hobbies.","@type":"BlogPosting","url":"https://emmasax4.info/blog/posts/time-zones-utc-and-javascript-oh-my/","headline":"Time Zones, UTC, and Javascript‚Ä¶ Oh My!","dateModified":"2020-06-29T22:35:31+00:00","datePublished":"2020-02-07T06:00:00+00:00","author":{"@type":"Person","name":"Emma Sax"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://emmasax4.info/blog/posts/time-zones-utc-and-javascript-oh-my/"},"@context":"https://schema.org"}
    </script>
    <!-- End Jekyll SEO tag -->
  </head>
  <header class="sticky-top">
    <nav class="navbar navbar-expand-md navbar-dark">
      <a class="navbar-brand mb-0" href="https://emmasax4.info" target="_self">
        <img src="/assets/images/logos/e-logo-white-40.png" width="30" height="30"
        class="d-inline-block align-top" alt="E logo"
      > Emma Sax
      </a>
      <button class="navbar-toggler" type="button" data-toggle="collapse"
      data-target="#navbar-links" aria-controls="navbar-links"
      aria-expanded="false" aria-label="Toggle navigation">
        <i data-feather="menu"></i>
        <i data-feather="x"></i>
      </button>
      <div class="collapse navbar-collapse" id="navbar-links">
        <ul class="navbar-nav ml-auto mt-2 mt-md-0">
          <li class="nav-item ">
            <a class="nav-link" href="/about-me/">About Me
            </a>
          </li>
          <li class="nav-item ">
            <a class="nav-link" href="/interests-and-hobbies/">Interests & Hobbies
            </a>
          </li>
          <li class="nav-item active">
            <a class="nav-link" href="/blog">Blog
              <span class="sr-only">(current)</span>
            </a>
          </li>
        </ul>
      </div>
    </nav>
  </header>
  <body>
    <main class="container">
      <div class="row">
        <div class="col col-12 col-md-2 text-center">
          <div class="container" style="padding-bottom: 1rem;">
            <a href="/blog/" class="btn btn-lg btn-outline-secondary">All Posts</a>
          </div>
          <div class="text-center" style="margin-bottom: .5rem;">
            <a href="/feed.xml" target="_blank" class="link-icon-rss">
              <i data-feather="rss"></i>
            </a>
          </div>
          <div class="text-center" style="margin-bottom: .5rem;">
            <span class="post-meta">
              <i style="width: 20px; height: 20px;" data-feather="tag"></i>
              <a href="/blog/tech/">
                tech
              </a>
            </span>
          </div>
          <div class="text-center" style="margin-bottom: 1rem;">
            <span class="post-meta">
              Read time: 9 minutes
            </span>
          </div>
        </div>
        <div class="col col-12 col-md-10">
          <h1 style="padding-bottom: .75rem;">
            <div class="text-center">
              Time Zones, UTC, and Javascript... Oh My!
            </div>
            <div class="text-center" style="margin-top: -.5rem;">
              <span class="date-meta">2020-02-07 00:00:00 -0600</span>
            </div>
          </h1>
          <div class="page-body">
            <p>On my latest blog post, I wanted to try something new. When publishing, I wanted to publish on a future date (specifically at midnight the next day). I set up the date of the post to include the next day, and then planned to go onto Travis at midnight to build the newest version of the site‚Ä¶ with the new blog post. And then I continued working on my website for the night.</p>
            <p>But what ended up happening was Travis CI built on my <code>release</code> branch at 6:15pm‚Ä¶ and suddenly my new blog post was live üò±! What happened? Well, Travis CI by default runs in UTC. So, since 6:00pm in CST is midnight in UTC, Travis CI determined it was time to publish the blog post. I quickly reverted that commit on my <code>gh-pages</code> branch to hide the new post once again, and then worked to find a solution to make Travis CI behave for the remainder of the night.</p>
            <p>What I ended up finding was this. By adding these lines to the <code>.travis.yml</code> file, we can override Travis CI‚Äôs default time zone and have it bundle in CST.</p>
            <pre><code class="language-yml">before_install:
  - export TZ=America/Chicago
</code></pre>
            <p>I thought I would be satisfied with this. I develop my site in CST (or CDT in the summer), and now Travis will also bundle in that time zone. But, after more thought, I realized that this is really just a bandaid fix ü§ï. What if I move across the country and now live in a different time zone permanently? What if I‚Äôm traveling internationally (say in France), and I‚Äôm blogging while I‚Äôm there. I‚Äôm no longer going to be thinking in terms of <code>America/Chicago</code> time zone‚Ä¶ say I publish a blog post at 12pm noon in France. When I get home to Minneapolis, should the blog post still show up as having been published at 12pm noon? Or should it properly show a 6‚Äì7 hour time difference?</p>
            <p>So after a lot of thinking, I decided that the best (and most sustainable) way to design a website is so that all dates/times are UTC in the database (Jekyll doesn‚Äôt have a DB, so just in the HTML, <code>feed.xml</code>, and <code>sitemap.xml</code>). Then, we can convert all UTC date/times to become in a user‚Äôs local time when they navigate to my site ‚è±.</p>
            <h2>The Goal</h2>
            <p>Time zones are complicated. I‚Äôve dabbled with them a little bit, but they tend to make my head spin üí´. So, I made hefty goal for myself ü•¥. When I publish a blog post, I can specify the publish date/time in <em>my</em> local time zone. Jekyll will build the blog post as having been published at the corresponding UTC time. And when a reader looks at the blog post on the website, it‚Äôll give the date/time in their local time zone (which may be <em>my</em> time zone, but it could also be different).</p>
            <p>Let‚Äôs look at an example. I publish a blog post at 10:15pm in CST on Jan. 17, 2020:</p>
            <pre><code>2020-01-17 22:15:00 -0600
</code></pre>
            <p>Jekyll will compile and store the blog post as having been published in UTC (notice the date change):</p>
            <pre><code>2020-01-18 04:15:00 +0000
</code></pre>
            <p>But when a reader looks at the blog post online, it will show in their local time zone (I normally hide the specific times when showing publishing dates):</p>
            <pre><code>### CST - Minnesota
January 17, 2020 22:15

### PST - California
January 17, 2020 20:15

### CEST - France
January 18, 2020 05:15
</code></pre>
            <p>Most of the time, I publish my blog posts at midnight on a specific date. This means that to everybody in <code>America/Chicago</code> and east of me, the date should be that specific date. But technically, to everybody west, the blog post went live on the day <em>before</em>.</p>
            <p>So, with this as my final goal, I went ahead to try to implement this in five steps:</p>
            <h3>1Ô∏è. The entire Jekyll site must build in UTC</h3>
            <p>This was easy. I set the following in my <code>_config.yml</code>:</p>
            <pre><code class="language-yml">timezone: UTC
</code></pre>
            <p>I also took this opportunity to remove the <code>export TZ=America/Chicago</code> from my <code>.travis.yml</code>, since now the Jekyll site and Travis CI will naturally be on the same wavelength.</p>
            <h3>2Ô∏è. Add the specific date/time of each blog posts‚Äô publish time</h3>
            <p>This was also pretty easy. You can just add the date to the front matter of each blog post:</p>
            <pre><code class="language-yml">date: 2020-01-17 22:15:00 -0600
</code></pre>
            <p>You can specify the time the post should be published as well, although, as I stated above, I normally just use <code>00:00:00</code>, or midnight. For what I‚Äôm working with, the last part is important. That‚Äôs the time zone offset. In Minnesota, that‚Äôll be <code>-0600</code> in the winter time (CST), or <code>-0500</code> in the summer (CDT)‚ÄîI always used to get those two mixed up. But, I‚Äôve decided that I want this to be easy for me to use going forward‚Ä¶ so I should always write the date/time as I‚Äôm looking at my clock (in 24 hour time of course) with my current time zone offset üìù.</p>
            <h3>3Ô∏è. Jekyll will store the blog post as being published in UTC</h3>
            <p>When I put both of these pieces together, the result was immediate. As soon as I ran <code>jekyll serve</code> on my website, I noticed that the <code>feed.xml</code> and <code>sitemap.xml</code> label the published date/time as in UTC! Yes! Nice and quick.</p>
            <h3>4Ô∏è. Show the users the published date/time in their local time zones</h3>
            <p>This was by far the most challenging part. I played with a Jekyll plugin first, to see if there was an easy way to convert the UTC date/time to be in a different time zone. This would‚Äôve worked, if I wanted to hard-code the new time zone (which defeats the purpose of it being flexible to the readers‚Äô location). So, after much googling, I realized the only good way to understand the readers‚Äô location and time zone offset is to use Javascript. Yay‚Ä¶. üò∞</p>
            <p>I‚Äôm not really a Javascript person. But, I jumped in anyway, and wanted to find a solution. Using some loop syntax from another slice of Javascript I use (read more about that <a href="/blog/posts/opening-links-in-new-tabs-via-javascript/">here</a>), I started typing away. I want the Javascript to go through the HTML, find all of the dates, and then convert them to the readers‚Äô local time and print that back out again.</p>
            <p>The entire script locates all of the HTML elements with the class <code>date-meta</code> (assuming that it is indeed a UTC date), and then Javascript makes it easy to change time zones:</p>
            <pre><code class="language-javascript">var monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                  'July','August', 'September', 'October','November', 'December'
];
var dateArray = '2020-01-18 04:15:00 +0000'.split(/[^0-9]/);
//  localDate = Fri Jan 17 2020 22:15:00 GMT-0600 (Central Standard Time)
var localDate = new Date(
  Date.UTC(dateArray[0], dateArray[1]-1, dateArray[2], dateArray[3], dateArray[4], dateArray[5])
);
var day = localDate.getDate(); // 17
var year = localDate.getFullYear(); // 2020
var monthIndex = localDate.getMonth(); // 0
return monthNames[monthIndex] + ' ' + day + ', ' + year; // January 17, 2020
</code></pre>
            <p>All together, this now looks like this:</p>
            <pre><code class="language-html">&lt;script type=&quot;text/javascript&quot;&gt;
  function showDatesInLocalTime() {
    var dates = document.getElementsByClassName('date-meta');
    var monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                      'July','August', 'September', 'October','November', 'December'
    ];

    for(counter = 0; counter &lt; dates.length; counter++) {
      var htmlDate = dates[counter];
      var dateArray = htmlDate.innerHTML.trim().split(/[^0-9]/);
      var localDate = new Date(
        Date.UTC(dateArray[0], dateArray[1]-1, dateArray[2], dateArray[3], dateArray[4], dateArray[5])
      );
      var day = localDate.getDate();
      var year = localDate.getFullYear();
      var monthIndex = localDate.getMonth();
      htmlDate.innerHTML = monthNames[monthIndex] + ' ' + day + ', ' + year;
    };
  };
  showDatesInLocalTime();
&lt;/script&gt;
</code></pre>
            <p>I‚Äôm hiding a lot of the effort this took me‚Ä¶ don‚Äôt get me wrong, it took me what felt like <em>hours</em> to develop this method, and I‚Äôm still finding bugs in it ü¶ü.</p>
            <h3>5Ô∏è. Don‚Äôt show the published date in the URL of the blog posts</h3>
            <p>In our example, I published a post on the 17th of January at night in CST. But we see now, that if I travel to France and look back at past blog posts, it‚Äôll look as if it was published on the 18th of January. BUT, the URL of the blog post will include the published date. See an example below:</p>
            <div class="text-center">
              <a data-flickr-embed="true" href="https://www.flickr.com/photos/184539266@N08/49498384557/in/album-72157710863695862/" title="Link to blog post including the date"><img class="image" src="https://live.staticflickr.com/65535/49498384557_42bd218c3d.jpg" width="500" height="31" alt="Link to blog post including the date"></a>
            </div>
            <p>If the date the site is showing the reader is moving around depending on the readers‚Äô location, then this is confusing‚Äîthe URL date won‚Äôt change!</p>
            <p>If I‚Äôm honest, having the date in the URL was never my favorite thing‚Ä¶ it always bugged me. I just never cared quite enough to change it, and to deal with the redirects I‚Äôd have to set up. But given this inconsistency, I decided that I finally cared enough to make the shift ‚Ü™.</p>
            <p>I added the <code>jekyll-redirect-from</code> plugin to my <code>_config.yml</code>. And from there, redirecting is actually quite easy. In the front matter of each blog post, I add the new URL of the blog post, and then redirect to the new URL from the old URL:</p>
            <pre><code class="language-yml">permalink: /blog/posts/opening-links-in-new-tabs-via-javascript/
redirect_from:
  - /blog/posts/2020-01-14-opening-links-in-new-tabs-via-javascript/
</code></pre>
            <p>Now, when I navigate to my blog posts at the old URL, my browser automatically redirects to the new URL. Hopefully that prevents my SEO ranking from going down üò¨.</p>
            <h2>Conclusion</h2>
            <p>At the end of the day, this goal maybe wasn‚Äôt too hefty. It maybe took about six hours of total effort. I haven‚Äôt traveled yet to see if it works as expected, but I have a trip planned in about a month, so we‚Äôll see then ü§∑üèª‚Äç‚ôÄÔ∏è.</p>
            <p>The moral of the story is that time zones are complicated, but the most robust websites will take them into account. If your website has date/times, then you should show them to your users in their local times, if possible. And you should be careful when storing data with date/times to make sure they are all stored in the same time zone, so they don‚Äôt get conflicted.</p>
            <p>I‚Äôm still working on perfecting my time zone processing. It‚Äôs complicated, and not all browsers react the same way to Javascript (who knew, right ¬Ø\_(„ÉÑ)_/¬Ø). But, I‚Äôd strongly urge to you take the plunge on your website‚Ä¶ it‚Äôll be worth it when your blog becomes internationally popular üòú.</p>
            <hr />
            <p>EDIT: Since writing this blog post, I‚Äôve moved my default branch to be <code>main</code>, instead of <code>release</code> and/or <code>source</code>. I originally named it <code>release</code> because the documentation I was following named it that, but realized later that the name <code>main</code> fit my workflow better. Also, I‚Äôve moved my <code>master</code> branch to be called <code>gh-pages</code>, and I‚Äôve updated this blog post accordingly.</p>
            <script src="/assets/js/show-comments.js" type="text/javascript"></script>
            <div class="text-center" style="margin-bottom: 1rem;">
              <button id="show-comments-button" class="btn btn-lg btn-outline-secondary"
  onclick="loadComments('emmasax4');return false;">
                Load Comments
                <i data-feather="message-circle"></i>
              </button>
            </div>
            <div id="disqus_thread"></div>
            <noscript>
              Please enable JavaScript to view the
              <a href="https://disqus.com/?ref_noscript" rel="nofollow">
                comments powered by Disqus.
              </a>
            </noscript>
          </div>
        </div>
      </div>
    </main>
  </body>
  <footer>
    &copy; <script>
      document.write(new Date().getFullYear());
    </script>
    Emma Sax. All rights reserved.
    <br>
    View on <a href="https://github.com/emmasax4/emmasax4.info">GitHub</a>.
  </footer>
  <script src="/assets/js/show-dates.js" type="text/javascript"></script>
  <script src="/assets/js/external-links.js" type="text/javascript"></script>
  <script src="/assets/js/jquery.min.js"></script>
  <script src="/assets/js/bootstrap.min.js"></script>
  <script src="/assets/js/feather.min.js"></script>
  <script>
    feather.replace()
  </script>
</html>