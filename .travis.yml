os: linux
language: ruby
cache: bundler

branches:
  only:
    - release

notifications:
  email:
    on_success: never
    on_failure: always
    recipients:
      - emma.sax4@gmail.com

# before_install:
#   - export TZ=America/Chicago

install:
  - bundle config set without 'development'
  - bundle install

jobs:
  include:
    - stage: Test
      name: Jekyll Build # and External HTML Proofer
      script:
        - JEKYLL_ENV=production bundle exec jekyll build --destination ./site
        # - htmlproofer --url-ignore "/linkedin/,/digikey/" --external-only --internal-domains "/emmasax4.info/" ./site
    - stage: Test
      name: HTML Proofer
      # if: (type IN (pull_request))
      script:
        - JEKYLL_ENV=production bundle exec jekyll build --destination ./site
        - htmlproofer --assume-extension --allow-hash-href --internal-domains "/emmasax4.info/" --url-ignore "/linkedin/,/digikey/" ./site
    # - stage: Test
    #   name: Internal HTML Proofer
    #   if: (type NOT IN (pull_request))
    #   script:
    #     - JEKYLL_ENV=production bundle exec jekyll build --destination ./site
    #   after_script:
    #     - htmlproofer --assume-extension --allow-hash-href --url-ignore "/linkedin/,/digikey/" ./site

    - stage: Deploy
      name: GitHub Pages
      if: (type NOT IN (pull_request)) AND (branch = release)
      script:
        - JEKYLL_ENV=production bundle exec jekyll build --destination ./site
      deploy:
        - provider: pages
          email: deploy@travis-ci.org
          name: Deployment Bot
          target_branch: master
          local_dir: ./site
          token: $GITHUB_TOKEN
          keep_history: true
          skip_cleanup: true
